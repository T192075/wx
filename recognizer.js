var e=require("@babel/runtime/helpers/interopRequireDefault")(require("@babel/runtime/regenerator")),t=require("@babel/runtime/helpers/asyncToGenerator"),r=require("@babel/runtime/helpers/classCallCheck"),n=require("@babel/runtime/helpers/createClass"),s=require("./encoder"),u=function(){function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,u),this.client=e,this.requestInterval=t,this.started=!1}var i;return n(u,[{key:"setRequestInterval",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.requestInterval=e}},{key:"start",value:function(e){this.cbs=e,this.resume(),this.started=!0}},{key:"isStared",value:function(){return this.started}},{key:"isRunning",value:function(){return this.running}},{key:"resumeOrStart",value:function(e){this.started?this.resume():this.start(e)}},{key:"pause",value:function(){this.running=!1,this.frame=null,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=null)}},{key:"resume",value:function(){this.running=!0,this.frame=null,this._search()}},{key:"stop",value:function(){this.pause(),this.cbs=null,this.started=!1}},{key:"setFrame",value:function(e){this.frame=e}},{key:"_search",value:(i=t(e.default.mark((function r(){var n=this;return e.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.running){r.next=2;break}return r.abrupt("return");case 2:this.frame&&s.encode(this.frame,function(){var r=t(e.default.mark((function t(r){return e.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.queryImage(r);case 2:0===(r=e.sent).statusCode&&n.cbs&&n.cbs.targetFound(r.result)&&n.cbs.onFound?setTimeout((function(){return n.cbs.onFound(r.result)})):n.cbs&&n.cbs.onLost&&setTimeout((function(){return n.cbs.onLost(r.result)}));case 4:case"end":return e.stop()}}),t)})));return function(e){return r.apply(this,arguments)}}()),this.timeoutID=setTimeout((function(){return n._search()}),this.requestInterval);case 4:case"end":return r.stop()}}),r,this)}))),function(){return i.apply(this,arguments)})}]),u}();module.exports=u;