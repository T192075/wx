var e=require("../@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("../@babel/runtime/regenerator")),i=require("../@babel/runtime/helpers/asyncToGenerator"),n=require("../@babel/runtime/helpers/classCallCheck"),s=require("../@babel/runtime/helpers/createClass"),a=require("./wxUtils"),r=function(){function e(t,i){n(this,e),this._videoId=t,this._canvasId=i,this._decoding=!1}var r;return s(e,[{key:"isDecoding",get:function(){return this._decoding}},{key:"init",value:(r=i(t.default.mark((function e(i){var n=this;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.p){e.next=4;break}return e.next=3,Promise.all([a.getVideoCtx.call(i,this._videoId),a.getCanvas.call(i,this._canvasId)]).then((function(e){n._videoCtx=e[0],n._canvas=e[1]}));case 3:this.p=e.sent;case 4:return this._decodeCtx=this._canvas.getContext("2d"),e.abrupt("return",this.p);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"decodeCtx",get:function(){return this._decodeCtx}},{key:"setInputSize",value:function(e,t){this._inputWidth=e,this._inputHeight=t}},{key:"setOutputSize",value:function(e,t){this._canvas.width=e,this._canvas.height=t}},{key:"start",value:function(e){this._videoCtx.play(),this._decoding=!0,this._onFrameReady=e,this._tick()}},{key:"_tick",value:function(){this._decoding&&this._canvas.requestAnimationFrame(this.decode.bind(this))}},{key:"decode",value:function(){var e=this;if(this._decodeCtx.drawImage(this._videoCtx,0,0,this._inputWidth,this._inputHeight,0,0,this._canvas.width,this._canvas.height),this._onFrameReady){var t=this._decodeCtx.getImageData(0,0,this._canvas.width,this._canvas.height);setTimeout((function(){return e._onFrameReady(t)}),0)}this._tick()}},{key:"stop",value:function(){this._videoCtx.stop(),this._decoding=!1}}]),e}();exports.default=r;