function r(r){Math.round;var a,n,o,f,e,t=Math.floor,v=new Array(64),i=new Array(64),u=new Array(64),w=new Array(64),c=new Array(65535),h=new Array(65535),y=new Array(64),A=new Array(64),d=[],g=0,s=7,m=new Array(64),l=new Array(64),M=new Array(64),p=new Array(256),D=new Array(2048),T=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],C=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],U=[0,1,2,3,4,5,6,7,8,9,10,11],_=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],x=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],N=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],S=[0,1,2,3,4,5,6,7,8,9,10,11],b=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],j=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function k(r,a){for(var n=0,o=0,f=new Array,e=1;e<=16;e++){for(var t=1;t<=r[e];t++)f[a[o]]=[],f[a[o]][0]=n,f[a[o]][1]=e,o++,n++;n*=2}return f}function q(r){for(var a=r[0],n=r[1]-1;n>=0;)a&1<<n&&(g|=1<<s),n--,--s<0&&(255==g?(z(255),z(0)):z(g),s=7,g=0)}function z(r){d.push(r)}function B(r){z(r>>8&255),z(255&r)}function E(r,a,n,o,f){for(var e,t=f[0],v=f[240],i=function(r,a){var n,o,f,e,t,v,i,u,w,c,h=0;for(w=0;w<8;++w){n=r[h],o=r[h+1],f=r[h+2],e=r[h+3],t=r[h+4],v=r[h+5],i=r[h+6];var A=n+(u=r[h+7]),d=n-u,g=o+i,s=o-i,m=f+v,l=f-v,M=e+t,p=e-t,D=A+M,T=A-M,C=g+m,U=g-m;r[h]=D+C,r[h+4]=D-C;var _=.707106781*(U+T);r[h+2]=T+_,r[h+6]=T-_;var x=.382683433*((D=p+l)-(U=s+d)),N=.5411961*D+x,S=1.306562965*U+x,b=.707106781*(C=l+s),j=d+b,k=d-b;r[h+5]=k+N,r[h+3]=k-N,r[h+1]=j+S,r[h+7]=j-S,h+=8}for(h=0,w=0;w<8;++w){n=r[h],o=r[h+8],f=r[h+16],e=r[h+24],t=r[h+32],v=r[h+40],i=r[h+48];var q=n+(u=r[h+56]),z=n-u,B=o+i,E=o-i,F=f+v,G=f-v,H=e+t,I=e-t,J=q+H,K=q-H,L=B+F,O=B-F;r[h]=J+L,r[h+32]=J-L;var P=.707106781*(O+K);r[h+16]=K+P,r[h+48]=K-P;var Q=.382683433*((J=I+G)-(O=E+z)),R=.5411961*J+Q,V=1.306562965*O+Q,W=.707106781*(L=G+E),X=z+W,Y=z-W;r[h+40]=Y+R,r[h+24]=Y-R,r[h+8]=X+V,r[h+56]=X-V,h++}for(w=0;w<64;++w)c=r[w]*a[w],y[w]=c>0?c+.5|0:c-.5|0;return y}(r,a),u=0;u<64;++u)A[T[u]]=i[u];var w=A[0]-n;n=A[0],0==w?q(o[0]):(q(o[h[e=32767+w]]),q(c[e]));for(var d=63;d>0&&0==A[d];d--);if(0==d)return q(t),n;for(var g,s=1;s<=d;){for(var m=s;0==A[s]&&s<=d;++s);var l=s-m;if(l>=16){g=l>>4;for(var M=1;M<=g;++M)q(v);l&=15}e=32767+A[s],q(f[(l<<4)+h[e]]),q(c[e]),s++}return 63!=d&&q(t),n}function F(r){if(r<=0&&(r=1),r>100&&(r=100),e!=r){(function(r){for(var a=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var o=t((a[n]*r+50)/100);o<1?o=1:o>255&&(o=255),v[T[n]]=o}for(var f=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],e=0;e<64;e++){var c=t((f[e]*r+50)/100);c<1?c=1:c>255&&(c=255),i[T[e]]=c}for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],y=0,A=0;A<8;A++)for(var d=0;d<8;d++)u[y]=1/(v[T[y]]*h[A]*h[d]*8),w[y]=1/(i[T[y]]*h[A]*h[d]*8),y++})(r<50?Math.floor(5e3/r):Math.floor(200-2*r)),e=r}}this.encode=function(r,e){(new Date).getTime();e&&F(e),d=new Array,g=0,s=7,B(65496),B(65504),B(16),z(74),z(70),z(73),z(70),z(0),z(1),z(1),z(0),B(1),B(1),z(0),z(0),function(){B(65499),B(132),z(0);for(var r=0;r<64;r++)z(v[r]);z(1);for(var a=0;a<64;a++)z(i[a])}(),function(r,a){B(65472),B(17),z(8),B(a),B(r),z(3),z(1),z(17),z(0),z(2),z(17),z(1),z(3),z(17),z(1)}(r.width,r.height),function(){B(65476),B(418),z(0);for(var r=0;r<16;r++)z(C[r+1]);for(var a=0;a<=11;a++)z(U[a]);z(16);for(var n=0;n<16;n++)z(_[n+1]);for(var o=0;o<=161;o++)z(x[o]);z(1);for(var f=0;f<16;f++)z(N[f+1]);for(var e=0;e<=11;e++)z(S[e]);z(17);for(var t=0;t<16;t++)z(b[t+1]);for(var v=0;v<=161;v++)z(j[v])}(),B(65498),B(12),z(3),z(1),z(0),z(2),z(17),z(3),z(17),z(0),z(63),z(0);var t=0,c=0,h=0;g=0,s=7,this.encode.displayName="_encode_";for(var y,A,p,T,k,G,H,I,J,K=new Uint8Array(r.data),L=r.width,O=r.height,P=4*L,Q=0;Q<O;){for(y=0;y<P;){for(G=k=P*Q+y,H=-1,I=0,J=0;J<64;J++)G=k+(I=J>>3)*P+(H=4*(7&J)),Q+I>=O&&(G-=P*(Q+1+I-O)),y+H>=P&&(G-=y+H-P+4),A=K[G++],p=K[G++],T=K[G++],m[J]=(D[A]+D[p+256>>0]+D[T+512>>0]>>16)-128,l[J]=(D[A+768>>0]+D[p+1024>>0]+D[T+1280>>0]>>16)-128,M[J]=(D[A+1280>>0]+D[p+1536>>0]+D[T+1792>>0]>>16)-128;t=E(m,u,t,a,o),c=E(l,w,c,n,f),h=E(M,w,h,n,f),y+=32}Q+=8}if(s>=0){var R=[];R[1]=s+1,R[0]=(1<<s+1)-1,q(R)}return B(65497),new Uint8Array(d)},function(){(new Date).getTime();r||(r=50),function(){for(var r=String.fromCharCode,a=0;a<256;a++)p[a]=r(a)}(),a=k(C,U),n=k(N,S),o=k(_,x),f=k(b,j),function(){for(var r=1,a=2,n=1;n<=15;n++){for(var o=r;o<a;o++)h[32767+o]=n,c[32767+o]=[],c[32767+o][1]=n,c[32767+o][0]=o;for(var f=-(a-1);f<=-r;f++)h[32767+f]=n,c[32767+f]=[],c[32767+f][1]=n,c[32767+f][0]=a-1+f;r<<=1,a<<=1}}(),function(){for(var r=0;r<256;r++)D[r]=19595*r,D[r+256>>0]=38470*r,D[r+512>>0]=7471*r+32768,D[r+768>>0]=-11059*r,D[r+1024>>0]=-21709*r,D[r+1280>>0]=32768*r+8421375,D[r+1536>>0]=-27439*r,D[r+1792>>0]=-5329*r}(),F(r),(new Date).getTime()}()}module.exports=function(a,n){void 0===n&&(n=50);return{data:new r(n).encode(a,n),width:a.width,height:a.height}};