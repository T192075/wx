require("../../common/vendor.js"),(global.webpackJsonp=global.webpackJsonp||[]).push([["pages/tickets/order/orderDetail/orderDetail"],{"1fe3":function(e,t,n){(function(e,o){var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("2eee")),u=a(n("c973")),s=a(n("9523")),c=a(n("2ef0")),i=n("3a85"),d=n("fc36"),l=n("b35a"),f=n("26cb");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m=null,g="感谢您对故宫博物院的支持，祝您参观愉快！",b=-999;t.default={components:{countDown:function(){n.e("pages/tickets/components/cut-down/countDown").then(function(){return resolve(n("1b35"))}.bind(null,n)).catch(n.oe)},KefuBar:function(){Promise.all([n.e("common/vendor"),n.e("pages/tickets/common/vendor"),n.e("pages/tickets/components/kefu-bar/index")]).then(function(){return resolve(n("fe65"))}.bind(null,n)).catch(n.oe)}},data:function(){return{toLast:"",contentHeight:0,size:c.default.size,buttonList:[{status:0,txt:"再次预定",desc:"感谢您对故宫博物院的支持!"},{status:1,txt:"立即支付",desc:"剩余支付时间 "},{status:3,txt:"申请退款",desc:g},{status:7,txt:"申请发票",desc:"感谢您对故宫博物院的支持，欢迎您再次参观！"},{status:26,txt:"申请退款",desc:g},{status:b,txt:"再次预订",desc:"订单已取消，您可以点击底部按钮再次预定"}],isMore:!1,detail:{showCutDown:!1,orderSum:0,orderCode:"",visitDateFormat:"",scheduleName:""},button:{show:!1,shadow:!1,status:0,txt:"再次预定",desc:"感谢您对故宫博物院的支持!"},showContactStaff:!1,staffPhoneList:[],method_use:{},refund_rules:{},pageMeta:{name:"订单详情页",category:"推荐",type:"详情页",column:"购票约展",plate:"订单"}}},computed:p({},(0,f.mapGetters)({buyer:"getMallBuyerData",getSysInfo:"getSysInfo",windowHeight:"windowHeight",statusBarHeight:"statusBarHeight"})),mounted:function(){var t=this;e.createSelectorQuery().select(".top-bar-class").boundingClientRect((function(e){var n=84+e.height,o=t.windowHeight-n;t.contentHeight=o})).exec()},onLoad:function(e){var t=this;return(0,u.default)(r.default.mark((function n(){var o;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.orderCode,n.next=3,t.getOrderDetail(o);case 3:if(!t.detail.yearPack){n.next=10;break}return n.next=6,(0,l.getModalContentByCodeId)({advertCode:"annual_pass_rules"});case 6:t.refund_rules=n.sent,t.isMore=!0,n.next=17;break;case 10:return n.next=12,(0,l.getModalContentByCodeId)({advertCode:"method_use"});case 12:return t.method_use=n.sent,n.next=15,(0,l.getModalContentByCodeId)({advertCode:"refund_rules"});case 15:t.refund_rules=n.sent,console.log("refund_rules",t.refund_rules);case 17:return n.next=19,t.pluginMallContactsInfo();case 19:case"end":return n.stop()}}),n)})))()},onShow:function(){m=new Date,console.log("onShow",m)},onUnload:function(){var e=new Date-m;console.log("onUnload",e),this.handleCommonUma("Um_Event_OrderPageView",{Um_Key_Duration:e})},onHide:function(){var e=new Date-m;console.log("onHide",e),this.handleCommonUma("Um_Event_OrderPageView",{Um_Key_Duration:e})},methods:p(p({},(0,f.mapActions)(["pluginMallContactsList","pluginMallrequestPayment","pluginMallContactsInfo"])),{},{getOrderDetail:function(t){var n=this;return(0,u.default)(r.default.mark((function o(){var a,u,s,d,l,f,h,p,m,g;return r.default.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return console.log(t),e.showLoading({title:"加载中..."}),o.next=4,(0,i.getMallOrderDetail)({orderCode:t});case 4:if(a=o.sent,e.hideLoading({noConflict:!0}),console.log(a,"detaildetail"),!c.default.isEmpty(a)){o.next=9;break}return o.abrupt("return");case 9:if(a.canBuyAddTickts&&(u=!1,s=a.goodsList,d=c.default.filter(s,(function(e){return-1===e.goodsName.indexOf("未成年人免费票")&&1===e.subType||9===e.subType})),console.log(s,d,c.default.size(d),"非未成年人主票"),c.default.size(d)>0&&(u=!0),a.canBuyChildTickts=u),l=a.orderStatus,f=a.checkStatus,h=a.yearPack,p=a.source,h&&(n.button.txt="重新购买",n.button.desc="订单已关闭,您可以点击底部按钮重新购买"),m=c.default.find(n.buttonList,{status:l}),n.button.show=!0,g=[3,26],n.button.shadow=c.default.includes(g,l),n.button.half=c.default.includes([1],l),!c.default.eq(l,7)){o.next=24;break}o.t0=f,o.next=-1===o.t0||4===o.t0?21:23;break;case 21:return m=c.default.find(n.buttonList,{status:0}),o.abrupt("break",24);case 23:console.log("订单已完成状态(".concat(l,")-检测核验状态(").concat(f,")"));case 24:m&&c.default.size(m.txt)>0&&(n.button.txt=m.txt,n.button.desc=m.desc),h&&3===l&&(n.button.txt="探索故宫",n.button.shadow=!1),"year"===p&&3===l&&(n.button.txt=" 取消登记"),n.detail=a;case 28:case"end":return o.stop()}}),o)})))()},buttonClick:function(){this.handleCommonUma("Um_Event_OrderButtonClick",{Um_Key_ButtonName:this.button.txt});var e=this.detail,t=e.orderStatus,n=e.yearPack;switch(t){case 1:this.payOrder();break;case 3:if(n){this.handleNavTour();break}case 26:this.goRefundOrderPage();break;case 7:this.goToCheckStatusDetail();break;default:this.toAddAgain()}},handleNavTour:function(){o.reLaunch({url:"/pages/tour/index"})},goRefundOrderPage:function(){var e=this;return(0,u.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.detail.orderCode,(0,d.navigateTo)(d.PAGE_PATH.TICKETS_APPLY_REFUND,{order:n});case 2:case"end":return t.stop()}}),t)})))()},payOrder:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,a,u,s,l,f,h,p,m,g,b,v;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.showLoading({title:"加载中..."}),o=t.detail,a=o.payOrderNo,u=o.orderCode,s=o.paySum,l=o.yearPack,n.next=4,(0,i.getMerchantPayType)({payOrderNo:a});case 4:return f=n.sent,h=f.channelProductCode,p=f.payType,m=t.buyer.openId,g={channelProductCode:h,payOrderNo:a,payType:p,paySum:s,openId:m,extendParamJson:{openId:m,channelProductCode:h}},n.next=11,(0,i.getOrderToPay)(g);case 11:if(b=n.sent,e.hideLoading({noConflict:!0}),!b.pay){n.next=17;break}return n.next=16,t.pluginMallrequestPayment(b).then((function(){e.showLoading({title:"加载中..."}),c.default.delay((function(){(0,d.navigateTo)(d.PAGE_PATH.TICKETS_RESULT,{orderCode:u,source:l?"yearPack":""},!0),e.hideLoading({noConflict:!0})}),5e3,"payfordone")}));case 16:return n.abrupt("return",!1);case 17:console.log(b,"payDatapayData"),v=b.message,e.showToast({title:v,icon:"none"});case 20:case"end":return n.stop()}}),n)})))()},toAddAgain:function(){this.detail.yearPack?(0,d.navigateTo)(d.PAGE_PATH.YEAR_PACK_SELECT,{},!0):(0,d.navigateTo)(d.PAGE_PATH.TICKETS_SELECT,{url:"orderDetail",source:this.detail.source},!0)},handleAddTickets:function(){this.handleCommonUma("Um_Event_OrderButtonClick",{Um_Key_ButtonName:"由此进入"});var e=this.detail.orderCode;(0,d.navigateTo)(d.PAGE_PATH.TICKETS_SELECT_ROOM,{url:"result",orderCode:e},!0)},goToCheckStatusDetail:function(){switch(this.detail.checkStatus){case 2:case 3:case 5:this.openPhoneModal();break;default:this.toAddAgain()}},openPhoneModal:function(){this.getServerPhone()},getServerPhone:function(){var e=this;return(0,u.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,l.getSysParamByKey)({key:"gugong_customerServiceTel"});case 2:n=t.sent,console.log(n,"getSysParamByKey"),200===n.status&&(e.staffPhoneList=n.message.split(","),e.showContactStaff=!0);case 5:case"end":return t.stop()}}),t)})))()},closePhoneModal:function(){this.showContactStaff=!1},callStaffPhone:function(e){this.handleCommonUma("Um_Event_OrderButtonClick",{Um_Key_ButtonName:"呼叫客服"}),o.makePhoneCall({phoneNumber:e}),this.showContactStaff=!1},clickMore:function(){this.isMore=!this.isMore,this.toLast=this.isMore?"refund_rules_last":""},openCancelPopup:function(){this.handleCommonUma("Um_Event_OrderButtonClick",{Um_Key_ButtonName:"取消订单"}),this.$refs.cancelPopup.open("center")},handleCancelOrder:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var o,a,u,s;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("--TODO取消订单--"),t.closeCancelPopup(),n.next=4,(0,i.getMallCancelOrder)({orderCode:t.detail.orderCode});case 4:o=n.sent,a=o.code,u=o.message,c.default.eq(a,200)?(e.showToast({title:"订单取消成功",duration:2e3,icon:"none",mask:!0}),t.detail.statusName="已取消",t.detail.showCutDown=!1,t.detail.orderStatus=b,s=c.default.find(t.buttonList,{status:b}),t.button=s,t.detail.yearPack&&(t.button.txt="重新购买",t.button.desc="订单已取消,您可以点击底部按钮重新购买"),t.button.show=!0):e.showToast({title:u,icon:"none"});case 8:case"end":return n.stop()}}),n)})))()},closeCancelPopup:function(){this.$refs.cancelPopup.close()}})}}).call(this,n("bc2e").default,n("543d").default)},"3b60":function(e,t,n){n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var o={topBar:function(){return Promise.all([n.e("common/vendor"),n.e("pages/components/top-bar/index")]).then(n.bind(null,"6ebb"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"27c0"))}},a=function(){this.$createElement;this._self._c},r=[]},c193:function(e,t,n){(function(e,t){var o=n("4ea4");n("6cdc"),o(n("66fd"));var a=o(n("f442"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("bc2e").default,n("543d").createPage)},d2ed:function(e,t,n){n.r(t);var o=n("1fe3"),a=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t.default=a.a},f442:function(e,t,n){n.r(t);var o=n("3b60"),a=n("d2ed");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("0264");var u=n("f0c5"),s=Object(u.a)(a.default,o.b,o.c,!1,null,null,null,!1,o.a,void 0);t.default=s.exports}},[["c193","common/runtime","common/vendor","pages/tickets/common/vendor"]]]);