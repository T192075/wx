Object.defineProperty(exports,"__esModule",{value:!0}),exports.sensorGyro=exports.sensorCompass=exports.sensorDeviceMotion=void 0;var e=require("../@babel/runtime/helpers/inherits"),t=require("../@babel/runtime/helpers/createSuper"),n=require("../@babel/runtime/helpers/createForOfIteratorHelper"),r=require("../@babel/runtime/helpers/classCallCheck"),i=require("../@babel/runtime/helpers/createClass"),s=wx.getSystemInfoSync(),o=function(){function e(t){r(this,e),this.name=void 0,this._current=new Set,this._callbacks={},this._working=!1,this.name=t}return i(e,[{key:"_start",value:function(){}},{key:"_stop",value:function(){}},{key:"trigger",value:function(e){if(this._current.size){var t,r=n(this._current);try{for(r.s();!(t=r.n()).done;){var i=t.value,s=this._callbacks[i];s&&s(e)}}catch(e){r.e(e)}finally{r.f()}}}},{key:"on",value:function(e){this._current.has(e)||(this._current.add(e),this._current.size>0&&(this._working||(this._working=!0,this._start())))}},{key:"off",value:function(e){this._current.delete(e),0===this._current.size&&this._working&&(this._working=!1,this._stop())}},{key:"register",value:function(e,t){this._callbacks[e]=t}},{key:"unregister",value:function(e){this.off(e),this._callbacks[e]&&delete this._callbacks[e]}}]),e}(),a=function(n){e(u,o);var a=t(u);function u(){return r(this,u),a.call(this,"DeviceMotion")}return i(u,[{key:"_start",value:function(){var e=this,t=0;"ios"===s.platform&&(t=null,h.register("DeviceMotion",(function(e){null===t&&(t=e.direction),setTimeout((function(){h.unregister("DeviceMotion")}))})),h.on("DeviceMotion")),wx.onDeviceMotionChange(this.onDeviceMotion=function(n){if(null!==t){var r={alpha:n.alpha-t,beta:n.beta,gamma:n.gamma};e.trigger(r)}}),wx.startDeviceMotionListening({interval:"game"})}},{key:"_stop",value:function(){wx.offDeviceMotionChange(this.onDeviceMotion),wx.stopDeviceMotionListening()}}]),u}(),u=function(n){e(a,o);var s=t(a);function a(){return r(this,a),s.call(this,"Compass")}return i(a,[{key:"_start",value:function(){var e=this;wx.onCompassChange(this.onCompass=function(t){return e.trigger(t)}),wx.startCompass()}},{key:"_stop",value:function(){wx.offCompassChange(this.onCompass),wx.stopCompass()}}]),a}(),c=function(n){e(a,o);var s=t(a);function a(){return r(this,a),s.call(this,"Gyro")}return i(a,[{key:"_start",value:function(){var e=this;wx.onGyroscopeChange(this.onGyroscope=function(t){return e.trigger(t)}),wx.startGyroscope({interval:"game"})}},{key:"_stop",value:function(){wx.offGyroscopeChange(this.onGyroscope),wx.stopGyroscope()}}]),a}(),l=new a;exports.sensorDeviceMotion=l;var h=new u;exports.sensorCompass=h;var f=new c;exports.sensorGyro=f;