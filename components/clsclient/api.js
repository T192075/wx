Object.defineProperty(exports,"__esModule",{value:!0}),exports.api=void 0;var n=require("./config"),t=require("../../utils/util"),e=require("../../request");function o(n,t,o,c,a){var r=Object.keys(o||{}),u=r.length?r.map((function(n){return"".concat(n,"=").concat(encodeURIComponent(o[n]))})).join("&"):void 0,i=n+(u?"?".concat(u):"");return new Promise((function(n,o){var r={url:i,method:t,success:function(t){n(t.data)},fail:function(n){o(n)}};c&&(r.header=c),a&&(r.data=a),e.wxapi.request(r)}))}var c={},a={};var r={request:o,getClsInfoAnonymous:function(t){return o("".concat(n.config.globalUrl,"/anonymous/cls/").concat(t),"GET",{},null,null)},getMaps:function(e,c,a){var r={ocKey:c,timestamp:(new Date).getTime(),loadARBindings:!0},u=Object.keys(r).sort().map((function(n){return"".concat(n).concat(r[n])})).concat(a).join("");return r.signature=(0,t.sha256)(u),o("".concat(n.config.arocUrl,"/startschema/").concat(e),"GET",r,null,null)},getManifest:function(e,c,a,r,u){var i={appId:a,timestamp:(new Date).getTime(),apiKey:r},s=Object.keys(i).sort().map((function(n){return"".concat(n).concat(i[n])})).concat(u).join("");return i.signature=(0,t.sha256)(s),o("".concat(n.config.arocUrl,"/arpackage/schema/").concat(e,"/target/").concat(c),"GET",i,null,null)},getToken:function(e,r){var u=(new Date).getTime();if(a[e]&&u<a[e])return Promise.resolve(c[e]);a[e]=u+36e5;var i={expires:3600,timestamp:u,apiKey:e},s=Object.keys(i).sort().map((function(n){return"".concat(n).concat(i[n])})).concat(r).join("");return i.signature=(0,t.sha256)(s),o("".concat(n.config.uacUrl,"/token/v2"),"POST",null,null,i).then((function(n){return n.result&&n.result.token?(c[e]=n.result.token,c[e]):(console.log("token error"),"TOKEN_ERROR")}))}};exports.api=r;