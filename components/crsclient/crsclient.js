var e=require("../../@babel/runtime/helpers/interopRequireDefault")(require("../../@babel/runtime/regenerator")),t=require("../../@babel/runtime/helpers/asyncToGenerator"),r=require("../../@babel/runtime/helpers/classCallCheck"),n=require("../../@babel/runtime/helpers/createClass"),i=require("../../pc"),a=(i.pcSetup,i.loadProject,i.loadScene,i.rotationFromMotion,i.setLicense),s=(i.loadNetworkScript,require("../../index")),o=(s.setCurrentCanvas,s.cancelLoadProject,s.setProjectBaseUrl,s.setProjectSign,require("../../crsClient")),c=require("../../recognizer"),u=wx.getSystemInfoSync(),g=u.windowWidth,l=u.windowHeight,h=function(){function e(t){r(this,e),this.self=t}return n(e,[{key:"takePhoto",value:function(e){return this.self.cameraCtx.takePhoto(e)}},{key:"getFrame",value:function(){return this.self.frame}}]),e}();Component({properties:{wxapi:{type:Object,value:null},crsConfig:{type:Object,value:null},requestInterval:{type:Number,value:0},targetIds:{type:Array,value:[]},requestConfig:{type:Object,value:{notracking:"true"}},setup:{type:Function,value:null},tearDown:{type:Function,value:null},license:{type:String,value:null},running:{type:Boolean,value:!0}},data:{canvasWidth:g,canvasHeight:l,canvasStyleWidth:"".concat(g,"px"),canvasStyleHeight:"".concat(l,"px"),cameraLoaded:!1,devicePosition:"back",recognizerConfig:null},observers:{requestConfig:function(e){this.crsClient&&this.crsClient.setRequestConfig(e)},running:function(e){if(!this.recognizer||!this.data.recognizerConfig)return this.waitForRunning();this.onRunningChange(e)},requestInterval:function(e){this.recognizer&&this.recognizer.setRequestInterval(e)}},methods:{waitForRunning:function(){var e=this;this._waited&&clearTimeout(this._waited),this.recognizer&&this.data.recognizerConfig?this.onRunningChange(this.data.running):this._waited=setTimeout((function(){return e.waitForRunning()}),300)},onRunningChange:function(e){e?this.recognizer.resumeOrStart(this.data.recognizerConfig):this.recognizer.pause()},onCameraInit:function(e){this._setup()},_setup:function(){var r=this;return t(e.default.mark((function t(){var n;return e.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.data.wxapi){e.next=4;break}return console.error("\u8bf7\u4f20\u5165\u5fae\u4fe1api"),r.triggerEvent("error",{msg:"\u8bf7\u4f20\u5165\u5fae\u4fe1api"}),e.abrupt("return");case 4:if(!r.data.license){e.next=14;break}return e.prev=5,e.next=8,a(r.data.license);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(5),r.triggerEvent("error",{msg:e.t0}),e.abrupt("return");case 14:n=wx.createCameraContext(),r.cameraCtx=n,r.data.crsConfig&&(r.crsClient=new o(r.data.crsConfig,r.data.wxapi,r.data.requestConfig),r.recognizer=new c(r.crsClient,r.data.requestInterval),r.cameraListener=n.onCameraFrame((function(e){r.frame=e,r.recognizer.setFrame(e)})),r.cameraListener.start(),r.data.recognizerConfig={targetFound:function(e){return!r.data.targetIds||!r.data.targetIds.length||r.data.targetIds.includes(e.target.targetId)},onFound:function(e){return r.triggerEvent("result",e)},onLost:function(e){return r.triggerEvent("lost",e)}},r.data.running&&r.recognizer.start(r.data.recognizerConfig)),r.triggerEvent("load",{crsCameraContext:new h(r)});case 18:case"end":return e.stop()}}),t,null,[[5,10]])})))()}},attached:function(){var e=this;console.log("crsclient attached"),"devtools"===u.platform&&setTimeout((function(){return e._setup()}),200),this.data.setup&&this.data.setup(this)},detached:function(){console.log("crsclient detached"),this.cameraListener&&this.cameraListener.stop(),this.recognizer&&this.recognizer.stop(),this.data.tearDown&&this.data.tearDown(this)},pageLifetimes:{show:function(){console.log("pageLifetimes show"),this.recognizer&&!this.recognizer.isRunning()&&!0===this._pausedByHide&&(this.recognizer.resume(),this._pausedByHide=void 0)},hide:function(){console.log("pageLifetimes hide"),this.recognizer&&this.recognizer.isRunning()&&(this.recognizer.pause(),this._pausedByHide=!0)}}});