require("../common/vendor.js"),(global.webpackJsonp=global.webpackJsonp||[]).push([["pages/pack/share/index"],{"4a6f":function(e,t,n){n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i}));var i={topBar:function(){return Promise.all([n.e("common/vendor"),n.e("pages/components/top-bar/index")]).then(n.bind(null,"6ebb"))},imageView:function(){return Promise.all([n.e("common/vendor"),n.e("pages/components/image-view/index")]).then(n.bind(null,"2ff9"))},tmSpin:function(){return Promise.all([n.e("common/vendor"),n.e("components/tm-spin/index")]).then(n.bind(null,"3c6d"))}},o=function(){this.$createElement;this._self._c},a=[]},a689:function(e,t,n){(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("2eee")),a=i(n("c973")),s=n("e199"),r=n("26cb");t.default={components:{byPoster:function(){n.e("pages/components/poster/index").then(function(){return resolve(n("2818"))}.bind(null,n)).catch(n.oe)}},data:function(){return{pageMeta:{name:"分享海报页面",category:"通用",type:"详情页",column:"",plate:""},showShareMenu:!0,ready:!1,loading:!0,src:"",initConfig:{width:750,height:1624,x:0,y:0},canvasConfig:{},lunarData:{}}},onLoad:function(e){var t=this;this.id=e.id,setTimeout((function(){t.getInitData()}),1e3)},computed:(0,r.mapState)({info:function(e){return e.home.shareData},userinfo:function(e){return e.user.info},static:function(e){return e.app.images}}),methods:{getInitData:function(){var e=this;return(0,a.default)(o.default.mark((function t(){var n,i,a;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.info,i=n.path,a=n.scene,t.prev=1,t.next=4,(0,s.getMiniCode)({path:i||"pages/index/index",scene:a}).then((function(t){var n=t.code,i=t.msg,o=t.data,a=void 0===o?{}:o;return 0!=n&&console.error("获取小程序码失败",i),a.url||e.static.wxa_code}));case 4:e.qrcodeUrl=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),e.qrcodeUrl=e.static.wxa_code;case 10:e.getCanvasConfig();case 11:case"end":return t.stop()}}),t,null,[[1,7]])})))()},loadComplete:function(){this.loading=!1},success:function(e){this.src=e.detail},fail:function(t){switch(console.error("fail",t),t.detail.errMsg){case"downloadFile:fail timeout":e.showToast({title:"图片下载失败",icon:"none"})}},saveImage:function(){var t=this;this.saveLock||(this.saveLock=!0,e.saveImageToPhotosAlbum({filePath:this.src,success:function(){e.showToast({icon:"none",title:"图片保存成功"})},fail:function(t){"saveImageToPhotosAlbum:fail auth deny"===t.errMsg?e.showModal({title:"用户未授权",content:'如果需要正常使用小程序功能，请按确定并在授权管理中打开"相册"。最后再进入小程序即可正常使用。',showCancel:!1,success:function(){e.openSetting()}}):e.showToast({icon:"none",title:t.errMsg})},complete:function(){t.saveLock=!1,t.tarEvent("save_album_click",{name:t.info.name,type:t.info.type,id:t.id})}}))},posterGetSuccess:function(e){this.src=e,this.loading=!1},getCanvasConfig:function(){var e=this,t=new Date,n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate(),a=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][t.getDay()];console.log(this.info,"shareText");var s="节气"===this.info.type?this.info.desc:"".concat(this.info.desc?this.info.desc+" · ":"").concat(this.info.title||this.info.name),r=160,c={zIndex:2,x:r,y:1289,fontSize:80,lineHeight:80,baseLine:"bottom",textAlign:"left",color:"#fff",fontFamily:"fzqkbys",text:i},f=this.$refs.poster.measureText(c),l={zIndex:2,x:r+f.width+10,y:1280,fontSize:28,lineHeight:28,baseLine:"bottom",textAlign:"left",color:"#fff",fontFamily:"fzqkbys",text:"月"},d={zIndex:2,x:r+f.width+10+50,y:1289,fontSize:80,lineHeight:80,baseLine:"bottom",textAlign:"left",color:"#fff",fontFamily:"fzqkbys",text:o},u=this.$refs.poster.measureText(d),h={zIndex:2,x:r+f.width+10+50+u.width+10,y:1280,fontSize:28,lineHeight:32,baseLine:"bottom",textAlign:"left",color:"#fff",fontFamily:"fzqkbys",text:"日"},g={zIndex:4,x:375,y:1375,width:630,lineNum:"auto",fontSize:32,lineHeight:40,baseLine:"top",textAlign:"center",color:"#3B2121",fontFamily:"fzqkbys",text:s},m=this.$refs.poster.measureText(g),x=Math.max(126,m.height+48);g.y=Math.floor(1335+(x-m.height)/2);var b={debug:!0,width:750,height:1330+x,x:0,y:0,backgroundColor:"#fff",texts:[g,{zIndex:2,x:132,y:1248,fontSize:28,lineHeight:32,baseLine:"bottom",textAlign:"right",color:"#fff",fontFamily:"fzqkbys",text:n+"年"},{zIndex:2,x:132,y:1280,fontSize:26,lineHeight:32,baseLine:"bottom",textAlign:"right",color:"#fff",fontFamily:"fzqkbys",text:a},c,l,d,h],images:[{zIndex:1,x:0,y:0,width:750,height:1330,url:this.info.pic},{zIndex:1,x:0,y:1120,width:750,height:210,url:this.static.shareCard.mask},{zIndex:3,x:587,y:1174,width:118,height:118,borderRadius:118,url:this.qrcodeUrl}],blocks:[{zIndex:0,x:0,y:0,width:750,height:1330,backgroundColor:"#efe7d9"},{zIndex:2,x:578,y:1165,width:136,height:136,borderRadius:136,backgroundColor:"#fffbf4"}],lines:[]};this.canvasConfig=b,this.ready=!0,console.log(this.canvasConfig),this.$nextTick((function(){e.$refs.poster.init(e.canvasConfig)}))}}}}).call(this,n("543d").default)},b670:function(e,t,n){(function(e,t){var i=n("4ea4");n("6cdc"),i(n("66fd"));var o=i(n("eed6"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("bc2e").default,n("543d").createPage)},d67a:function(e,t,n){n.r(t);var i=n("a689"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t.default=o.a},eed6:function(e,t,n){n.r(t);var i=n("4a6f"),o=n("d67a");for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("fb40");var s=n("f0c5"),r=Object(s.a)(o.default,i.b,i.c,!1,null,"4fdea65c",null,!1,i.a,void 0);t.default=r.exports}},[["b670","common/runtime","common/vendor","pages/pack/common/vendor"]]]);