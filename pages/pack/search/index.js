require("../common/vendor.js"),(global.webpackJsonp=global.webpackJsonp||[]).push([["pages/pack/search/index"],{"42d4":function(e,t,r){r.r(t);var n=r("44ca"),i=r("67b0");for(var o in i)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return i[e]}))}(o);r("f569");var a=r("f0c5"),s=Object(a.a)(i.default,n.b,n.c,!1,null,"b9f71eb2",null,!1,n.a,void 0);t.default=s.exports},"44ca":function(e,t,r){r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n}));var n={topBar:function(){return Promise.all([r.e("common/vendor"),r.e("pages/components/top-bar/index")]).then(r.bind(null,"6ebb"))},tmSpin:function(){return Promise.all([r.e("common/vendor"),r.e("components/tm-spin/index")]).then(r.bind(null,"3c6d"))}},i=function(){var e=this,t=(e.$createElement,e._self._c,e.isShowKeywords?e.searchHistory.length:null),r=e.isShowKeywords?e.searchHot.length:null,n=e.__map(e.tabList,(function(t,r){return{$orig:e.__get_orig(t),g2:t.init&&t.list&&t.list.length}}));e.$mp.data=Object.assign({},{$root:{g0:t,g1:r,l0:n}})},o=[]},"67b0":function(e,t,r){r.r(t);var n=r("e1dd"),i=r.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t.default=i.a},"7e59":function(e,t,r){(function(e,t){var n=r("4ea4");r("6cdc"),n(r("66fd"));var i=n(r("42d4"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(i.default)}).call(this,r("bc2e").default,r("543d").createPage)},e1dd:function(e,t,r){(function(e){var n=r("4ea4"),i=r("7037");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(r("2eee")),a=n(r("c973")),s=n(r("9523")),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=i(e)&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=o?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}(r("e73b")),u=n(r("5d2d"));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.default={name:"Index",components:{buildingCard:function(){Promise.all([r.e("common/vendor"),r.e("pages/components/building-card/index")]).then(function(){return resolve(r("e67e"))}.bind(null,r)).catch(r.oe)},searchBar:function(){Promise.all([r.e("common/vendor"),r.e("pages/components/search-bar/index")]).then(function(){return resolve(r("dfb7"))}.bind(null,r)).catch(r.oe)},commonCardMh:function(){Promise.all([r.e("common/vendor"),r.e("pages/components/common-card-mh/index")]).then(function(){return resolve(r("b0e3"))}.bind(null,r)).catch(r.oe)},listEmpty:function(){Promise.all([r.e("common/vendor"),r.e("pages/components/listEmpty/index")]).then(function(){return resolve(r("7da2"))}.bind(null,r)).catch(r.oe)}},data:function(){return{pageMeta:{name:"搜索页面",category:"搜索",type:"列表页",column:"",plate:""},isShowKeywords:!0,tabList:[{title:"全部",id:0,init:!1,page:1,list:[],pageSize:20,more:!0,loading:!1},{title:"文物",id:1,page:1,init:!1,pageSize:20,more:!0,list:[],loading:!1},{title:"名画",id:2,page:1,init:!1,list:[],pageSize:10,more:!0,loading:!1},{title:"建筑",id:3,page:1,init:!1,list:[],pageSize:10,more:!0,loading:!1}],currentKeyword:"",currentType:0,isOnlyHasPic:!0,searchHistory:[],searchHot:[],searchFocus:!1}},onShareAppMessage:function(e){return d({},this.$store.state.app.shares)},methods:{onSearch:function(e){this.searchByKeyword(e)},onFocus:function(){this.isShowKeywords=!0},searchTag:function(e,t){e!==this.currentKeyword?(this.$refs.searchBar.reset(e),this.searchByKeyword(e)):this.isShowKeywords=!1,this.handleCommonBeacon("search_suggest_click",{type:t,keyword:e})},searchByKeyword:function(e){if(e=e.trim()){var t=this.searchHistory,r=this.searchHistory.indexOf(e);r>=0?(t.splice(r,1),t.unshift(e),this.searchHistory=t):t.unshift(e),this.searchHistory=t.splice(0,20),this.currentKeyword!=e?(this.currentKeyword=e,this.resetTabList(),this.isShowKeywords=!1,this.getSearchResult()):this.isShowKeywords=!1,u.default.set("searchHistory",this.searchHistory,!0)}},onCancel:function(){this.isShowKeywords&&this.currentKeyword?(this.$refs.searchBar.reset(this.currentKeyword),this.isShowKeywords=!1):e.navigateBack()},resetTabList:function(){this.tabList=this.tabList.map((function(e){return d(d({},e),{},{page:1,init:!1,list:[],pageSize:10,more:!0,loading:!1})}))},changeSwiper:function(e){this.changeType(e.detail.current),this.tabList[e.detail.current]},changeType:function(e){var t=this.tabList[e];this.currentType=t.id,t.init||this.getSearchResult(),this.tarEvent("search_tab_change",{type:this.tabList[e]})},switchOnlyPic:function(){this.isOnlyHasPic=!this.isOnlyHasPic,this.resetTabList(),this.getSearchResult(),this.tarEvent("search_hasImg_click",{hasImg:this.isOnlyHasPic})},getSearchHot:function(){var e=this;c.searchGetHistory().then((function(t){var r=t.data,n=r.hot,i=(r.history,n?n.map((function(e){return e.key})):[]),o=u.default.get("searchHistory")?u.default.get("searchHistory"):[];e.searchHot=i,e.searchHistory=o}))},getSearchResult:function(){var e=this;return(0,a.default)(o.default.mark((function t(){var r,n,i,a,s,u,l,h,d,f;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.currentKeyword){t.next=3;break}return t.abrupt("return");case 3:if(n=e.currentType,i=e.tabList[n],a=i.page,s=i.list,u=i.more,l=i.loading,h=i.pageSize,!l&&u){t.next=7;break}return t.abrupt("return");case 7:return e.tabList[n].loading=!0,t.next=10,c.searchByKeyword({keyword:r,type:e.currentType,isHasBigImage:e.isOnlyHasPic?1:0,page:a});case 10:(d=t.sent)&&0==d.code&&(f=s.concat(d.data.list),e.tabList[e.currentType].list=1==a?d.data.list:s.concat(d.data.list),console.log(d,"resultList"),d.data.count<=a*h&&(e.tabList[n].more=!1),e.tabList[n].page++,e.tabList[n].init=!0,e.handleCommonUma("Um_Event_SearchComplete",{Um_Key_SearchKeyword:r,Um_key_SearchResult:f.length?"有":"无"})),e.tabList[n].loading=!1;case 13:case"end":return t.stop()}}),t)})))()},onTabScrollBottom:function(e){this.getSearchResult(e)},clearHistory:function(){u.default.remove("searchHistory",!0),this.searchHistory=[]}},onLoad:function(){this.searchFocus=!0,this.getSearchHot()}}}).call(this,r("543d").default)}},[["7e59","common/runtime","common/vendor","pages/pack/common/vendor"]]]);