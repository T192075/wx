require("../../common/vendor.js"),(global.webpackJsonp=global.webpackJsonp||[]).push([["pages/tickets/buytickets/result/result"],{"05c1":function(e,t,n){n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var o={topBar:function(){return Promise.all([n.e("common/vendor"),n.e("pages/components/top-bar/index")]).then(n.bind(null,"6ebb"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"27c0"))}},a=function(){this.$createElement;this._self._c},r=[]},"0db6":function(e,t,n){n.r(t);var o=n("cdd5"),a=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t.default=a.a},6721:function(e,t,n){n.r(t);var o=n("05c1"),a=n("0db6");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("0341");var u=n("f0c5"),c=Object(u.a)(a.default,o.b,o.c,!1,null,"7efa26f1",null,!1,o.a,void 0);t.default=c.exports},b2a8:function(e,t,n){(function(e,t){var o=n("4ea4");n("6cdc"),o(n("66fd"));var a=o(n("6721"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("bc2e").default,n("543d").createPage)},cdd5:function(e,t,n){(function(e,o){var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("2eee")),u=a(n("c973")),c=a(n("9523")),s=n("f1c8"),i=n("fc36"),l=n("3a85"),d=n("b35a"),f=n("4dcf"),p=n("26cb"),m=a(n("2ef0"));function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g="Um_Event_PayPageView",P="Um_Event_PayButtonClick",v=null;t.default={components:{ticketCheckModal:function(){Promise.all([n.e("pages/tickets/common/vendor"),n.e("pages/tickets/components/ticket-check-modal/index")]).then(function(){return resolve(n("4f70"))}.bind(null,n)).catch(n.oe)}},data:function(){return{COS_PATH:s.COS_PATH,orderCode:"",convertPayStatus:!1,payResult:{},showContactStaff:!1,staffPhoneList:[],showType:0,checkPieceContent:{},rules:"",source:"",pageMeta:{name:"支付结果页",category:"推荐",type:"结果页",column:"购票约展",plate:"订单"},noticeData:{title:"检票提醒",content:""}}},computed:h({},(0,p.mapGetters)({buyer:"getMallBuyerData"})),onLoad:function(e){console.log(e,"******pages onload options*******");var t=e.orderCode,n=(e.type,e.source);this.options=e,this.orderCode=t,this.source=n,this.getPayResult(),"year"===this.source&&(P="Um_Event_YearTicketPayButtonClick",g="Um_Event_YearTicketPayPageView")},onShow:function(){v=new Date,console.log("onShow",v)},onHide:function(){var e=new Date-v;console.log("onHide",e,this.source,g),this.handleCommonUma(g,{Um_Key_Duration:e})},onUnload:function(){var e=new Date-v;this.handleCommonUma(g,{Um_Key_Duration:e})},mounted:function(){},methods:h(h({},(0,p.mapActions)(["pluginMallrequestPayment"])),{},{getPayResult:function(){var e=this;return(0,u.default)(r.default.mark((function t(){var n,o,a,u,c,s,i,f;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.orderCode,e.convertPayStatus,o=e.options,a=o.type,u=o.source,t.next=4,(0,l.getMallOrderDetail)({orderCode:n});case 4:return c=t.sent,console.log(c,"getMallOrderDetail - 订单详情"),e.payResult=c,!m.default.isEmpty(c)&&c.canBuyAddTickts&&(s=!1,i=c.goodsList,f=m.default.filter(i,(function(e){return-1===e.goodsName.indexOf("未成年人免费票")&&1===e.subType||9===e.subType})),console.log(i,f,m.default.size(f),"非未成年人主票"),m.default.size(f)>0&&(s=!0),e.payResult.canBuyChildTickts=s),t.next=10,(0,d.getModalContentByCodeId)({advertCode:"check_in"});case 10:if(e.checkPieceContent=t.sent,"yearPack"!==u){t.next=16;break}return e.source=u,t.next=15,(0,d.getModalContentByCodeId)({advertCode:"annual_pass_rules"});case 15:e.rules=t.sent;case 16:if(!m.default.eq(a,"2")){t.next=19;break}return e.showType=a,t.abrupt("return",!1);case 19:e.retryPayStatus();case 20:case"end":return t.stop()}}),t)})))()},retryPayStatus:function(){var e=this;return(0,u.default)(r.default.mark((function t(){var n,o,a,u,c;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.payResult.payOrderNo,t.next=3,(0,l.getPayOrderDeatil)({payOrderNo:n});case 3:return o=t.sent,console.log(o,"getPayOrderDeatil - 支付单详情"),a=Number(o.payStatus),u=m.default.find(s.PAYMENT_STATUS,{status:a}),console.log(u,"payStatusConvert"),c=u.status||0,e.noticeData.content=o.payResultPageTip||"",(m.default.eq(c,1)||m.default.eq(c,0))&&(e.showType=c),m.default.eq(c,0)&&(0,f.retry)(e.attemptPayStatus(c),{retries:3,timeout:1e3,interval:1e3}).then((function(e){return console.log("成功:",e)}),(function(e){return console.log("失败:",e)})),t.abrupt("return",c);case 13:case"end":return t.stop()}}),t)})))()},attemptPayStatus:function(){return(0,u.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},handleAddTickets:function(){this.handleCommonUma(P,{Um_Key_ButtonName:"增购票型"}),(0,i.navigateTo)(i.PAGE_PATH.TICKETS_SELECT_ROOM,{url:"result",orderCode:this.orderCode})},handleNavHome:function(){this.handleCommonUma(P,{Um_Key_ButtonName:"返回首页"}),(0,i.navigateTo)(i.PAGE_PATH.TICKETS_HOME,{url:"result"},"reLaunch")},handleRepay:function(){var t=this;return(0,u.default)(r.default.mark((function n(){var a,u,c,s,d,f,p,y,h;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.handleCommonUma(P,{Um_Key_ButtonName:"重新支付"}),e.showLoading({title:"加载中..."}),a=t.payResult,u=a.payOrderNo,c=a.orderCode,s=a.paySum,console.log(t.payResult,"this.payResult"),n.next=6,(0,l.getMerchantPayType)({payOrderNo:u});case 6:return d=n.sent,f=d.channelProductCode,p=d.payType,y=t.buyer.openId,n.next=12,(0,l.getOrderToPay)({channelProductCode:f,payOrderNo:u,payType:p,paySum:s,openId:y,extendParamJson:{openId:y,channelProductCode:f}});case 12:if(h=n.sent,e.hideLoading({noConflict:!0}),!h.pay){n.next=19;break}return n.next=17,t.pluginMallrequestPayment(h).then((function(){e.showLoading({title:"加载中..."}),m.default.delay((function(){(0,i.navigateTo)(i.PAGE_PATH.TICKETS_RESULT,{orderCode:c,source:t.source},!0),e.hideLoading({noConflict:!0})}),5e3,"payfordone")}));case 17:n.next=22;break;case 19:console.log(h,"payDatapayData"),o.showLoading({title:"加载中",mask:!0}),setTimeout((function(){o.hideLoading(),t.handleReviewOrder()}),4e3);case 22:case"end":return n.stop()}}),n)})))()},handleReviewOrder:function(){this.handleCommonUma(P,{Um_Key_ButtonName:"查看订单"}),(0,i.navigateTo)(i.PAGE_PATH.TICKETS_ORDER,{},"reLaunch")},handleNavTour:function(){this.handleCommonUma(P,{Um_Key_ButtonName:"探索故宫"}),o.reLaunch({url:"/pages/tour/index"})},getServerPhone:function(){var e=this;return(0,u.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(P,"拨打咨询电话"),e.handleCommonUma(P,{Um_Key_ButtonName:"拨打咨询电话"}),t.next=4,(0,d.getSysParamByKey)({key:"gugong_customerServiceTel"});case 4:n=t.sent,console.log(n,"getSysParamByKey"),200===n.status&&(e.staffPhoneList=n.message.split(","),e.$refs.ContactStaff.open("bottom"));case 7:case"end":return t.stop()}}),t)})))()},closePhoneModal:function(){this.$refs.ContactStaff.close()},callStaffPhone:function(e){o.makePhoneCall({phoneNumber:e}),this.showContactStaff=!1}})}}).call(this,n("bc2e").default,n("543d").default)}},[["b2a8","common/runtime","common/vendor","pages/tickets/common/vendor"]]]);