require("../../../common/vendor.js"),(global.webpackJsonp=global.webpackJsonp||[]).push([["pages/tickets/buytickets/yearPack/select/select"],{"04cb":function(e,t,n){n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={topBar:function(){return Promise.all([n.e("common/vendor"),n.e("pages/components/top-bar/index")]).then(n.bind(null,"6ebb"))}},a=function(){var e=this,t=(e.$createElement,e._self._c,e.ticketsTypeLists.length),n=e.ticketsTypeLists.length;e.$mp.data=Object.assign({},{$root:{g0:t,g1:n}})},o=[]},"86fd":function(e,t,n){(function(e,t){var r=n("4ea4");n("6cdc"),r(n("66fd"));var a=r(n("d2cd"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("bc2e").default,n("543d").createPage)},"95fc":function(e,t,n){(function(e,r){var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("2eee")),c=a(n("9523")),s=a(n("c973")),i=n("fc36"),u=a(n("a78c")),f=n("f1c8"),l=n("b35a"),d=a(n("2ef0")),p=n("3a85");function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g="";t.default={components:{calendar:function(){Promise.all([n.e("pages/tickets/common/vendor"),n.e("pages/tickets/components/calendar/calendar")]).then(function(){return resolve(n("7a9f"))}.bind(null,n)).catch(n.oe)}},data:function(){return{height:"",hideModal:!0,info:{subscribe_limit:5},name:"",openTime:"",endTime:"",ticketsTypeLists:[],selectNum:0,notice:"",rules:"",pageMeta:{name:"购买年票数量页",category:"推荐",type:"填写页",column:"购票约展",plate:"套票信息填写"}}},onLoad:function(t){var n=this;return(0,s.default)(o.default.mark((function a(){var c,s,i,u;return o.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log(t,"******pages onload options*******"),c=n.systemInfo,s=c.statusBarHeight,i=c.system,u=/ios/i.test(i)?44:46,e.createSelectorQuery().select("#reserve-footer").boundingClientRect((function(e){console.log(e,"res");var t=e.height,a=r.getSystemInfoSync().windowHeight-u-s-t;console.log(a,"height"),n.height=a})).exec(),r.showLoading({title:"加载中"}),a.next=8,n.init(t);case 8:case"end":return a.stop()}}),a)})))()},methods:{init:function(){var e=this;return(0,s.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getOrderDate();case 2:g=t.sent,e.getTicketsTypeByDate();case 4:case"end":return t.stop()}}),t)})))()},getOrderDate:function(){return(0,s.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.getSysParamByKey)({key:"annual_rules_day"});case 2:return t=e.sent,e.abrupt("return",null==t?void 0:t.message);case 4:case"end":return e.stop()}}),e)})))()},getParkInfo:function(){var e=this;return(0,s.default)(o.default.mark((function t(){var n,r,a,c;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,l.getMerchantParkInfo)({id:f.YEAR_PACK_ID});case 2:n=t.sent,console.log(n,"parkInfo"),r=n.nickName,a=n.openTime,c=n.endTime,e.name=r,e.openTime=a,e.endTime=c;case 8:case"end":return t.stop()}}),t)})))()},getTicketsTypeByDate:function(){var e=this;return(0,s.default)(o.default.mark((function t(){var n,r,a,c;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$dayjs(g).format("YYYY-MM-DD"),console.log(n,"stime"),t.next=4,(0,p.getChantParkTicketList)({date:n,merchantParkInfoId:f.YEAR_PACK_ID});case 4:r=t.sent,a=r.ticketList,console.log(a,"ticketsTypeLists"),c=[],d.default.forEach(a,(function(e){e.data=0;var t={};t.modelCode=e.modelCode,t.externalCode=e.externalCode,t.startTime=g,t.endTime=g,c.push(t)})),e.getTicketsStatus(c,a);case 10:case"end":return t.stop()}}),t)})))()},getTicketsStatus:function(e,t){var n=this;return(0,s.default)(o.default.mark((function a(){var c,s,i;return o.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log(e,"queryParam"),a.next=3,(0,p.getMallBatchTimeReserveList)({queryParam:e});case 3:c=a.sent,s=[],console.log(c,"ticketLists"),d.default.forEach(c,(function(e){var t=e.fsList;d.default.forEach(t,(function(t){s.push(h(h({},t),{},{modelCode:e.modelCode}))}))})),i=[],d.default.forEach(t,(function(e){d.default.forEach(s,(function(t){if(e.modelCode===t.modelCode){var n=h(h({},t),e);i.push(n)}}))})),console.log(i,"newTicketsTypeLists"),n.ticketsTypeLists=i,r.hideLoading();case 12:case"end":return a.stop()}}),a)})))()},addTicketsNum:function(e,t){e.num<=0?r.showToast({title:"年票已售罄",icon:"none"}):this.selectNum>=this.info.subscribe_limit||(this.$set(this.ticketsTypeLists[t],"data",e.data+1),this.selectNum=this.selectNum+1)},delTicketsNum:function(e,t){0!=e.data&&(this.$set(this.ticketsTypeLists[t],"data",e.data-1),this.selectNum=this.selectNum-1)},onConfirm:function(){var e=this;return(0,s.default)(o.default.mark((function t(){var n,a,c,s;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!=e.selectNum){t.next=4;break}return r.showToast({title:"请选择门票数量",icon:"none"}),t.abrupt("return");case 4:if(n=!0,d.default.forEach(e.ticketsTypeLists,(function(e){if(e.data>e.num)return r.showToast({title:"年票库存不足",icon:"none"}),void(n=!1)})),n){t.next=8;break}return t.abrupt("return");case 8:for(a=[],c=e.ticketsTypeLists,s=0;s<c.length;s++)c[s].data>0&&a.push(c[s]);console.log(a,"tickets"),u.default.set(a,"selectTicketList"),u.default.set(g,"selectDate"),(0,i.navigateTo)(i.PAGE_PATH.YEAR_PACK_PERSON,{source:"yearPack",name:e.source});case 15:case"end":return t.stop()}}),t)})))()},openNotice:function(e){this.notice=e,this.$refs.popupNotice.open("bottom")},closeNotice:function(){this.$refs.popupNotice.close()}}}}).call(this,n("543d").default,n("bc2e").default)},b814:function(e,t,n){n.r(t);var r=n("95fc"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t.default=a.a},d2cd:function(e,t,n){n.r(t);var r=n("04cb"),a=n("b814");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("c9d9");var c=n("f0c5"),s=Object(c.a)(a.default,r.b,r.c,!1,null,"3a3482c8",null,!1,r.a,void 0);t.default=s.exports}},[["86fd","common/runtime","common/vendor","pages/tickets/common/vendor"]]]);