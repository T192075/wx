require("../common/vendor.js"),(global.webpackJsonp=global.webpackJsonp||[]).push([["pages/tickets/buyroom/buyroom"],{"018e":function(e,t,n){n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var o={uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"27c0"))}},a=function(){var e=this,t=(e.$createElement,e._self._c,e.loading?null:e.ticketsTypeLists.length),n=e.loading?null:e.ticketsTypeLists.length;e.$mp.data=Object.assign({},{$root:{g0:t,g1:n}})},r=[]},"7dec":function(e,t,n){n.r(t);var o=n("e631"),a=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t.default=a.a},"866d":function(e,t,n){n.r(t);var o=n("018e"),a=n("7dec");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("fb05");var c=n("f0c5"),s=Object(c.a)(a.default,o.b,o.c,!1,null,"4dbce0c4",null,!1,o.a,void 0);t.default=s.exports},e1c3:function(e,t,n){(function(e,t){var o=n("4ea4");n("6cdc"),o(n("66fd"));var a=o(n("866d"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("bc2e").default,n("543d").createPage)},e631:function(e,t,n){(function(e){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("2eee")),r=o(n("9523")),c=o(n("c973")),s=n("26cb"),i=n("f1c8"),l=o(n("a78c")),u=n("fc36"),f=n("a887"),d=n("3a85"),p=n("b35a"),h=o(n("2ef0"));function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=n("9210");t.default={components:{TicketTopbar:function(){Promise.all([n.e("pages/tickets/common/vendor"),n.e("pages/tickets/components/top-bar/index")]).then(function(){return resolve(n("4201"))}.bind(null,n)).catch(n.oe)}},data:function(){return{color:"#fff",background:"",loading:!0,info:{name:"",pic:"",subscribe_limit:5},notickets:"".concat(i.COS_PATH,"/no_tickets.png"),selectNum:0,cardType:[],selectDate:"",showDate:"",schedule:"",source:"",title:"购买内馆门票",notice:"",ticketsTypeLists:[{}],name:""}},onReady:function(e){return(0,c.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},onLoad:function(t){var n=this;return(0,c.default)(a.default.mark((function o(){return a.default.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(console.log(l.default.get("mallLoginToken").accessToken,"accessToken"),l.default.get("mallLoginToken").accessToken){o.next=4;break}return o.next=4,n.pluginMallLoginGetToken();case 4:return console.log(t,"******pages onload options*******"),e.showLoading({title:"加载中"}),console.log("mallOpenId",l.default.get("mallOpenId")),k.init({channel:"108994",openid:l.default.get("mallOpenId")},(function(e){console.log(e,"res init")})),o.next=10,n.init(t);case 10:case"end":return o.stop()}}),o)})))()},computed:g({},(0,s.mapGetters)({buyer:"getMallBuyerData"})),methods:g(g({},(0,s.mapActions)(["pluginMallDecryptData","pluginMallContactsInfo","pluginMallLoginGetToken"])),{},{init:function(e){var t=this;return(0,c.default)(a.default.mark((function n(){var o,r,c,s,l,u,f;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=e.source,r=e.name,c=e.id,t.source=o,t.name=r,s=c||i.NAME_MAP[r]||i.INNER_HALL_MERCHANT_PARK_ID,t.parkId=s,t.getParkInfo(),"display"===o&&(t.title="预约展览门票"),l=(new Date).getTime(),t.selectDate=t.$dayjs(l).format("YYYYMMDD"),t.showDate=t.$dayjs(l).format("YYYY-MM-DD"),u=t.$dayjs(l).format("a"),f=i.DAY_LMAT[u].name,t.schedule=f,console.log(t.buyer,"****buyer信息****");case 14:case"end":return n.stop()}}),n)})))()},getParkInfo:function(){var t=this;return(0,c.default)(a.default.mark((function n(){var o,r;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,p.getMerchantParkInfo)({id:t.parkId});case 2:o=n.sent,t.info.name=o.nickName,t.info.pic=o.linkMobileImg,r=o.isTodayHaltSales,console.log(o,"parkInfo"),"F"===r?t.timeReserveList():(t.ticketsTypeLists=[],e.hideLoading({noConflict:!0}),t.loading=!1);case 8:case"end":return n.stop()}}),n)})))()},timeReserveList:function(){var t=this;return(0,c.default)(a.default.mark((function n(){var o,r,c,s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,d.getMallChantCalendar)({year:t.selectDate.slice(0,4),month:t.selectDate.slice(4,6),parkId:t.parkId});case 2:o=n.sent,console.log(o,"getMallChantCalendar"),r=[],c="",h.default.forEach(o,(function(e){var n=e.occDate.replaceAll("-","");n===t.selectDate&&(console.log(n,"occDate"),c=e.saleStatus,e.parkFsyyDetailDTOS&&(r=e.parkFsyyDetailDTOS))})),console.log(r.length,"parkFsyyDetailDTOS.size"),"T"===c&&h.default.size(r)>0&&r[0].stockNum>0?((s=r[0].fsTimeRange.split(" ~ "))[0],s[1],t.getTicketsTypeByDate()):t.ticketsTypeLists=[],e.hideLoading({noConflict:!0}),t.loading=!1;case 11:case"end":return n.stop()}}),n)})))()},getTicketsTypeByDate:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var n,o,r,c;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,d.getChantParkTicketList)({date:e.getTextByDate(e.selectDate),merchantParkInfoId:e.parkId});case 2:n=t.sent,o=n.ticketList,console.log(o,"ticketsTypeLists"),r=e.getTextByDate(e.selectDate),c=[],h.default.forEach(o,(function(e){e.data=0;var t={};t.modelCode=e.modelCode,t.externalCode=e.externalCode,t.startTime=r,t.endTime=r,c.push(t)})),console.log(o,"ticketsTypeLists"),console.log(c,"queryParam"),e.getTicketsStatus(c,o);case 11:case"end":return t.stop()}}),t)})))()},getTicketsStatus:function(e,t){var n=this;return(0,c.default)(a.default.mark((function o(){var r,c,s;return a.default.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,d.getMallBatchTimeReserveList)({queryParam:e});case 2:r=o.sent,console.log(r,"ticketLists"),c=[],h.default.forEach(r,(function(e){var t=e.fsList;h.default.forEach(t,(function(t){t.num>0&&c.push(g(g({},t),{},{modelCode:e.modelCode}))}))})),console.log(c,"filterTicketLists"),s=[],h.default.forEach(t,(function(e){h.default.forEach(c,(function(t){if(e.modelCode===t.modelCode){var n=g(g({},t),e);console.log(n,"cur"),s.push(n)}}))})),console.log(s,"newTicketsTypeLists"),n.ticketsTypeLists=s;case 11:case"end":return o.stop()}}),o)})))()},addTicketsNum:function(e,t){console.log(123),this.selectNum>=this.info.subscribe_limit||("room"===this.source&&this.$set(this.ticketsTypeLists[t],"data",e.data+1),this.selectNum=this.selectNum+1)},delTicketsNum:function(e,t){if("room"===this.source){if(0==e.data)return;this.$set(this.ticketsTypeLists[t],"data",e.data-1)}this.selectNum>0&&(this.selectNum=this.selectNum-1)},onConfirm:function(){var t=this;return(0,c.default)(a.default.mark((function n(){return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log(t.buyer.hasPhone,"hasPhone"),0===t.selectNum?e.showToast({title:"请选择门票数量",icon:"none"}):t.buyer.hasPhone&&t.handleConfirm();case 2:case"end":return n.stop()}}),n)})))()},handleConfirm:function(){var e=[],t=this.ticketsTypeLists;h.default.size(t)>0&&("room"===this.source?e=h.default.filter(t,(function(e){return e.data>0})):e.push(g(g({},t[0]),{},{modelName:this.info.name,data:this.selectNum,price:0})),console.log(e,"selectTicketList"),l.default.set(e,"selectTicketList"),l.default.set(this.selectDate,"selectDate"),l.default.set(this.schedule,"selectSchedule"),(0,u.navigateTo)(u.PAGE_PATH.TICKETS_PERSON,{source:this.source,name:this.name}))},getPhoneNumber:function(e){var t=this;return(0,c.default)(a.default.mark((function n(){var o,r,c,s;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("getPhoneNumber:ok"!==e.detail.errMsg){n.next=8;break}return o=e.detail,r=o.encryptedData,c=o.iv,n.next=4,t.pluginMallDecryptData({data:r,iv:c});case 4:return s=n.sent,n.next=7,(0,f.putMallContactsPhone)({phone:s.phoneNumber});case 7:t.handleConfirm();case 8:case"end":return n.stop()}}),n)})))()},openNotice:function(e){this.notice=e,this.$refs.popupNotice.open("bottom")},closeNotice:function(){this.$refs.popupNotice.close()},getTextByDate:function(e){var t=e.slice(0,4),n=e.slice(4,6),o=e.slice(6,8);return"".concat(t,"-").concat(n,"-").concat(o)},scroll:function(t){console.log(t,"e");var n=t.detail.scrollTop;this.color=n>60?"#000":"#fff",this.background="rgba(248,243,232, ".concat(n/160,")"),n>60?e.setNavigationBarColor({backgroundColor:"#FFF9F4",frontColor:"#000000"}):e.setNavigationBarColor({backgroundColor:"#000000",frontColor:"#ffffff"})}})}}).call(this,n("bc2e").default)}},[["e1c3","common/runtime","common/vendor","pages/tickets/common/vendor"]]]);