require("../../common/vendor.js"),(global.webpackJsonp=global.webpackJsonp||[]).push([["pages/tickets/order/applyRefund/applyRefund","pages/tickets/components/ui-fit/index"],{2894:function(e,t,n){(function(e){var r=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n("2eee")),c=r(n("c973")),a=r(n("9523")),i=r(n("a712")),u=n("b35a"),s=n("fc36"),d=n("3a85"),l=n("f1c8"),f=n("26cb"),h=r(n("2ef0")),p=n("f2d7"),v=n("4dcf"),g=r(n("294b"));function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}t.default={data:function(){return{COS_PATH:l.COS_PATH,order:{},detail:{},fee:0,phone:"",checked:!0,phoneError:!1,uiFit:i.default,advertCode:"default_rules",default_rules:{},contentHeight:0,title:"申请退款",source:"",pop_title:"请确认您的退票信息",pageMeta:{name:"申请退款页",category:"推荐",type:"详情页",column:"购票约展",plate:"订单"}}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},(0,f.mapGetters)({token:"getMallLoginToken",buyer:"getMallBuyerData",getSysInfo:"getSysInfo",windowHeight:"windowHeight",statusBarHeight:"statusBarHeight"})),mounted:function(){var t=this,n=0;e.createSelectorQuery().select(".top-bar-class").boundingClientRect((function(e){n=e.height+84;var r=t.windowHeight-n;t.contentHeight=r})).exec()},onLoad:function(e){var t=this;return(0,c.default)(o.default.mark((function n(){return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getOrderDetail(e);case 2:return"year"===t.source&&(t.title="取消登记",t.pop_title="请确认您要取消的门票",t.advertCode="annual_default_rules"),n.next=5,(0,u.getModalContentByCodeId)({advertCode:t.advertCode});case 5:t.default_rules=n.sent,console.log("default_rules",t.default_rules);case 7:case"end":return n.stop()}}),n)})))()},methods:{getOrderDetail:function(t){var n=this;return(0,c.default)(o.default.mark((function r(){var a,i;return o.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=t.order,e.showLoading({title:"加载中..."}),r.next=4,(0,d.getMallOrderDetail)({orderCode:a});case 4:i=r.sent,console.log(i,"detaildetail"),e.hideLoading({noConflict:!0}),n.phone=n.buyer.phoneNumber,h.default.forEach(i.visitors,function(){var e=(0,c.default)(o.default.mark((function e(t){var n,r,c,a;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.default.filter(t.goodsList,{canUsed:!0}),t.canUsedSize=h.default.size(n),t.showVisitor=t.canUsedSize>0,r=0,h.default.forEach(n,(function(e){r+=e.paySum})),t.curPaySum=r,!h.default.eq(t.visitorCertType,0)){e.next=12;break}return e.next=9,(0,d.getQueryViolateInfo)({skuCode:t.mainTicketCode,certNo:t.visitorCertNo});case 9:c=e.sent,a=c.realBreakCount,t.realBreakCount=a;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),console.log(i,"detail"),n.detail=i,n.source=i.source;case 12:case"end":return r.stop()}}),r)})))()},handleApply:function(){this.$refs.Popup.open("center")},confirm:function(){this.getOrderRefund()},getOrderRefund:function(){var t=this;return(0,c.default)(o.default.mark((function n(){var r,c,a,i,u,l,f,p,v,k;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.detail,c=r.orderCode,console.log(r),e.showLoading({title:"加载中...",mask:!0}),a=[],h.default.forEach(r.visitors,(function(e){if(e.hasOneCheck){var t={visitorCertType:e.visitorCertType,visitorCertNo:e.visitorCertNo,refundGoodsList:[]};h.default.forEach(e.goodsList,(function(e){if(e.check&&e.canUsed){var n={goodsCode:e.goodsCode,goodsType:e.goodsType,subType:e.subType,quantity:e.quantity,orderItemId:e.orderItemId};t.refundGoodsList.push(n)}})),a.push(t)}})),i={orderCode:c,orderRefundItems:a},console.log(i,"退单列表数据"),n.next=10,(0,d.getMallOrderRefund)(i);case 10:if(u=n.sent,l=u.code,f=u.message,e.hideLoading({noConflict:!0}),!h.default.eq(l,200)){n.next=20;break}return n.next=16,(0,d.getMiniProgramTemplate)();case 16:return p=n.sent,h.default.isEmpty(p)||(k=null===(v=h.default.find(p,{templateType:"park-OrderRefundFinishEvent"}))||void 0===v?void 0:v.templateId,g.default.subscription([k])),(0,s.navigateTo)(s.PAGE_PATH.TICKETS_REFUBD_RESULT,{orderCode:c,source:t.detail.source},"reLaunch"),n.abrupt("return",!1);case 20:e.showToast({title:f,icon:"none",duration:4e3,mask:!0,success:function(){}});case 21:case"end":return n.stop()}}),n)})))()},handleCheckall:function(){var e=this.detail;try{var t=!e.check;e.check=t,h.default.forEach(e.visitors,(function(e){e.check=t,e.hasOneCheck=t,h.default.forEach(e.goodsList,(function(e){e.check=t}))})),this.detail=e,this.calcCheckedFee()}catch(e){console.log(e)}},handleCheckUser:function(e){var t=this.detail;t.check=!1;try{var n=t.visitors[e].check;t.visitors[e].check=!n,t.visitors[e].hasOneCheck=!n,h.default.forEach(t.visitors[e].goodsList,(function(e){e.check=!n})),this.detail=t,this.calcCheckedFee()}catch(e){console.log(e)}},handleCheckOne:function(e,t){var n=this.detail;n.check=!1;try{var r=n.visitors[e].goodsList[t].check,o=!1;n.visitors[e].goodsList[t].check=!r,h.default.forEach(n.visitors[e].goodsList,(function(e,t){e.check&&(o=!0)}));var c=n.visitors[e].goodsList[t].subType;h.default.includes([1,3,9],Number(c))&&this.handleCheckUser(e),n.visitors[e].hasOneCheck=o,this.detail=n,this.calcCheckedFee()}catch(e){console.log(e)}},calcCheckedFee:function(){var e=this;return(0,c.default)(o.default.mark((function t(){var n,r,c,a;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.detail,r=!0,c=0,h.default.forEach(n.visitors,(function(e){console.log(e.check,"itemitemitem"),h.default.forEach(e.goodsList,(function(e){e.check&&e.canUsed&&(c+=e.paySum,r=!1)}));var t=h.default.filter(e.goodsList,{check:!0,canUsed:!0}),n=h.default.size(t);e.canCheckedSize=n,h.default.eq(n,0)&&(e.check=!1,e.hasOneCheck=!1)})),console.log(n,"detail"),a=!1,(0,p.checkPhone)(e.phone)||(a=!0,r=!0),e.checked=r,e.phoneError=a,e.fee=(0,v.keepTwoDecimalFull)(c),t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)})))()},handleClose:function(){this.$refs.Popup.close()},checkPhoneInput:function(e){this.phoneError=!0,this.checked=!0,(0,p.checkPhone)(e)&&(this.phoneError=!1,this.checked=!1)}}}}).call(this,n("bc2e").default)},3849:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default={props:{src:{type:String,default:function(){return"https://industry.map.qq.com/cloud/file/2022/06/23/1655970511514_XWesS4XH.png"}},width:{type:Number,default:function(){return 750}},height:{type:Number,default:function(){return 1624}}},methods:{}}},"5f93":function(e,t,n){n.r(t);var r=n("3849"),o=n.n(r);for(var c in r)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(c);t.default=o.a},"6d3e":function(e,t,n){(function(e,t){var r=n("4ea4");n("6cdc"),r(n("66fd"));var o=r(n("c24a"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("bc2e").default,n("543d").createPage)},"8d7c":function(e,t,n){n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var r=function(){this.$createElement;this._self._c},o=[]},a712:function(e,t,n){n.r(t);var r=n("8d7c"),o=n("5f93");for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);n("d30a");var a=n("f0c5"),i=Object(a.a)(o.default,r.b,r.c,!1,null,"ca9d94f8",null,!1,r.a,void 0);t.default=i.exports},c24a:function(e,t,n){n.r(t);var r=n("d9c4"),o=n("c2c6");for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);n("6dd9");var a=n("f0c5"),i=Object(a.a)(o.default,r.b,r.c,!1,null,"e8edaea8",null,!1,r.a,void 0);t.default=i.exports},c2c6:function(e,t,n){n.r(t);var r=n("2894"),o=n.n(r);for(var c in r)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(c);t.default=o.a},d9c4:function(e,t,n){n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return r}));var r={topBar:function(){return Promise.all([n.e("common/vendor"),n.e("pages/components/top-bar/index")]).then(n.bind(null,"6ebb"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"27c0"))}},o=function(){var e=this,t=(e.$createElement,e._self._c,e.__map(e.detail.visitors,(function(t,n){return{$orig:e.__get_orig(t),g0:t.showVisitor?e.detail.visitors.length:null,g1:t.showVisitor?e.detail.visitors.length:null}})));e.$mp.data=Object.assign({},{$root:{l0:t}})},c=[]}},[["6d3e","common/runtime","common/vendor","pages/tickets/common/vendor"]]]);